<!DOCTYPE html>
<!-- saved from url=(0045)https://moi31.netlify.app/edit%20profile.html -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Moi Space</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <link rel="stylesheet" href="/userProfile.css">
  </head>

  <body>
    <div class="app">
      <!--Header Starts Here-->
      <section id="HEADER">
        <!--Header Top Div Begins Here-->
        <div id="HEADER-TOP-DIV">
          <div id="APP-DETAILS">
            <div id="HEADER-LOGO"></div>
            <div id="HEADER-APPNAME"><h2>Moi Space</h2></div>
          </div>

          <div id="HEADER-BTNS">
            <button id="INTERESTSH-BTN" class="HEADER-BTNS"><a href="/home"><span class="material-symbols-outlined">home_app_logo</span></a></button>
            <button id="CHATSH-BTN" class="HEADER-BTNS"><a href="/chats">
                <span class="material-symbols-outlined">chat_bubble</span></a>
              <div id="MSG-BADGE" class="BADGE">3</div>
            </button>
          </div>

          <div id="USER-DETAILS">
            <div id="HEADER-USERNAME"><h3><%= user.username%></h3></div>
            <div id="HEADER-PROFILEPIC"></div>
          </div>
        </div>

        <!--Header Middle Div Begins Here-->
        <div id="HEADER-MIDDLE-DIV"><h3>Made for Moi University</h3></div>
      </section>

      <main class="content">
        <section class="profile-card">
          <div class="info">
            <div class="editable-photo">
              <img
                class="profile-photo"
                src='/mediafiles/darkishImagegirl.jpg'
                alt="profile"
              />
              <span class="edit-icon" title="Change photo">âœï¸</span>
              <input
                type="file"
                accept="image/*"
                class="photo-input"
                hidden=""
              />
            </div>

            <div id="infos">
              <div class="change" id="profName"><%=user.username%></div>
              <input id="course" type="text" class="change" value="Computer Science" />
              <input id="year" type="text" class="change" value="First Year" />
            </div>
            <button class="log-out">Log Out</button>
          </div>
        </section>

        <div class="slogan">Personal slogan will appear here...</div>

        <section class="gallery">
          <div class="item">
            <img src="/mediafiles/darkgirl.jpg"/>
            <span class="edit-icon" title="Change image">âœï¸</span>
            <input type="file" accept="image/*" class="photo-input" hidden="" />
          </div>
          <div class="item">
            <img src="/mediafiles/darkishImagegirl.jpg" alt="pic 2" />
            <span class="edit-icon" title="Change image">âœï¸</span>
            <input type="file" accept="image/*" class="photo-input" hidden="" />
          </div>
          <div class="item">
            <img src="/mediafiles/roseFlower.jpg" alt="pic 3" />
            <span class="edit-icon" title="Change image">âœï¸</span>
            <input type="file" accept="image/*" class="photo-input" hidden="" />
          </div>
        </section>

        <p class="desc-title">About Me</p>
        <textarea class="desc-box" id="aboutMe">
          A heart that believes in magic, connection, and the little sparks that make life beautiful. I wander through the world with curiosity and an open soul, always drawn to moments that make me smile, laugh, or feel deeply.

           Iâ€™m a dreamer at heart â€” cherishing sunsets, long conversations, and the quiet warmth of shared moments. Love, in all its forms, inspires me to be kind, patient, and endlessly hopeful. I thrive on genuine connections, sweet surprises, and the joy of discovering beauty in the ordinary.

          Life feels like a story waiting to be written, and I embrace it with a tender heart, a little bit of courage, and a lot of hope that every day brings a chance to love and be loved. ğŸ’–ğŸŒ¹
</textarea>
          <p class="desc-title">About You</p>
        <textarea class="desc-box" id="aboutYou">
          You should be someone who can make me laugh even on the dullest days, someone who loves deep conversations as much as spontaneous adventures. Youâ€™re thoughtful, kind, and confident without being arrogant â€” a heart thatâ€™s big enough to care and gentle enough to listen.

          You should enjoy little moments â€” like holding hands, sharing secrets, or just staring at the stars together. A sense of humor is essential, and bonus points if you can tease me just enough to keep me on my toes.

          You should be passionate about something â€” anything that makes your eyes light up â€” and be excited to explore life with a little curiosity and a lot of heart. Basically, youâ€™re someone who can be my partner-in-crime, my safe space, and maybe even the reason I believe in magic. ğŸ’–âœ¨
        </textarea>
        <button id="submit">Submit Changes</button>
      </main>
    </div>

    <script>
    
      let submit = document.getElementById("submit");
      let changedImages = [];
      let aboutMe = document.getElementById("aboutMe").value;
      let aboutYou = document.getElementById("aboutYou").value;
      let username = localStorage.getItem("mainUser");
      let course=document.getElementById("course").value
      let year=document.getElementById("year").value

      document.querySelectorAll(".edit-icon").forEach((icon) => {
        icon.addEventListener("click", () => {
          let fileInput = icon.nextElementSibling;
          fileInput.click();

          fileInput.addEventListener("change", (e) => {
            let file = e.target.files[0];
            if (file) {
              let reader = new FileReader();
              reader.onload = (e) => {
                let img = icon.parentElement.querySelector("img");
                img.src = e.target.result;
              };
              reader.readAsDataURL(file);

              let imageId =
                icon.parentElement.querySelector("img").alt || "unnamed";
              let existingIndex = changedImages.findIndex(
                (item) => item.id === imageId
              );

              if (existingIndex >= 0) {
                changedImages[existingIndex].file = file;
              } else {
                changedImages.push({ id: imageId, file });
              }

              console.log("Changed images:", changedImages);
            }
          });
        });
      });

   async function uploadChangedImages() {
  if (changedImages.length === 0) {
    alert("No images changed!");
    return;
  }

  let formData = new FormData();
  formData.append("username", username);
  changedImages.forEach((item) => {
    if (item.id.startsWith("pic") || item.id.includes("gallery")) {
      formData.append("gallery_" + item.id, item.file);
    } else {
      formData.append("prof_" + item.id, item.file);
    }
  });

  let resPics = await fetch("/profile/update/pics", {
    method: "POST",
    body: formData,
  });

  let data1 = await resPics.json();
  alert(data1.message || "Pictures updated!");

  setTimeout(async () => {
    let resText = await fetch("/profile/update/text", {
      method: "POST",
      headers: { "Content-Type": "application/json" }, 
      body: JSON.stringify({
        username: username,
        aboutMe: aboutMe,
        aboutYou: aboutYou,
        course: course,
        year: year
      }),
    });

    let textData = await resText.json();
    console.log("Text response:", textData);
  }, 10);
}

      submit.addEventListener("click", uploadChangedImages);
    
      const box1e = [...document.querySelectorAll(".desc-box")]
let box1 = box1e[0]
let box2 = box1e[1]
let height;
let height1;

// Box1 events
box1.addEventListener('focus', () => {
  // Reset box2 height if you want
  box2.style.height = 'auto'
  box2.style.minHeight = '0px'
  box2.style.height = '50px'  // you had auto then 50px, simplified

  // Store current box1 height correctly
  height = box1.offsetHeight + 'px'

  // Auto-resize box1
  box1.style.height = 'auto'
  box1.style.height = box1.scrollHeight + 'px'
})

box1.addEventListener('blur', () => {
  box1.style.height = height
})

// Box2 events
box2.addEventListener('focus', () => {
  // Store current box2 height correctly
  height1 = box2.offsetHeight + 'px'
  box1.style.minHeight = '0px'
  box1.style.height = 'auto'
  box2.style.height = '20px'
  // Auto-resize box2
  box2.style.height = 'auto'
  box2.style.height = box2.scrollHeight + 'px'
})

box2.addEventListener('blur', () => {
  box2.style.height = height1
})

    </script>
  </body>
</html>
